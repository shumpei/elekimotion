<!DOCTYPE html>
<title>ElekiMotion</title>
<html lang="ja">
  <body>
    <button id="get-motion" onclick="getMotion()">Request Permission</button><br>
    acceleration-x: <span id="acceleration-x"></span><br>
    acceleration-y: <span id="acceleration-y"></span><br>
    acceleration-z: <span id="acceleration-z"></span><br>
    acceleration-gravity-x: <span id="acceleration-gravity-x"></span><br>
    acceleration-gravity-y: <span id="acceleration-gravity-y"></span><br>
    acceleration-gravity-z: <span id="acceleration-gravity-z"></span><br>
    rotation-alpha: <span id="rotation-alpha"></span><br>
    rotation-beta: <span id="rotation-beta"></span><br>
    rotation-gamma: <span id="rotation-gamma"></span><br>

    <div id="console">
    </div>
    <script>
      async function getMotion(){
        if (!window.DeviceMotionEvent || !window.DeviceMotionEvent.requestPermission){
          return alert("Your current device does not have access to the DeviceMotion event");
        }
      
        let permission = await window.DeviceMotionEvent.requestPermission();
        if (permission !== "granted"){
          return alert("You must grant access to the device's sensor for this demo");
        }
      }
      let flipStartY;
      let flipStartGY;
      window.addEventListener("devicemotion", function(e){
        let requestBtn = document.querySelector("#get-motion");
        if (requestBtn){requestBtn.remove();}
        
        document.getElementById('acceleration-x').innerHTML = e.acceleration.x.toFixed(2)+"m/s²";
        document.getElementById('acceleration-y').innerHTML = e.acceleration.y.toFixed(2)+"m/s²";
        document.getElementById('acceleration-z').innerHTML = e.acceleration.z.toFixed(2)+"m/s²";
        
        document.getElementById('acceleration-gravity-x').innerHTML = e.accelerationIncludingGravity.x.toFixed(2)+"m/s²";
        document.getElementById('acceleration-gravity-y').innerHTML = e.accelerationIncludingGravity.y.toFixed(2)+"m/s²";
        document.getElementById('acceleration-gravity-z').innerHTML = e.accelerationIncludingGravity.z.toFixed(2)+"m/s²";
        
        document.getElementById('rotation-alpha').innerHTML = e.rotationRate.alpha.toFixed(2)+"°/s";
        document.getElementById('rotation-beta').innerHTML = e.rotationRate.beta.toFixed(2)+"°/s";
        document.getElementById('rotation-gamma').innerHTML = e.rotationRate.gamma.toFixed(2)+"°/s";

        if (e.acceleration.y < -10) {
          if (!flipStart) {
            flipStartY = e.acceleration.y
            flipStartGY = e.accelerationIncludingGravity.y
          } else {
            // 大きく下に動かした
            if (flipStartGY - e.accelerationIncludingGravity.y > 5) {
              document.getElementById('console').innerHTML = "fliped!";
            }
          }
        }
      });
    </script>
  </body>
</html>
